---
title: nuxt3 CICD模索
description: 樂居CICD建置過程分享
slug: nuxt3-CICD-build
date: 2024-07-07
type: Post
---

## CI/CD
當我們常常在求職網站上看到CI/CD這個名詞時，他由兩個名詞所組成 Continuous Integration/Continuous Delivery(或Deployment)，中文翻譯成持續整合/持續交付(或部署)，簡單來說就是把我們平常開發程式碼的流程自動化，讓我們在每次push程式碼到遠端倉庫時，可以自動幫我們做測試、打包、部署等工作，減少人為操作的錯誤率，提高開發效率。
而當過工程師才更確定一件事情，那就是應該盡可能地減少重複工作，把時間花在更有價值的事情上，而CI/CD正是幫助我們達成這個目標的利器。
他能夠幫我們檢查程式碼的品質、確保程式碼能夠順利運行，並且自動化部署到伺服器上，讓我們能夠更專注於開發新的功能，而不是花時間在部署上。
甚至當錯誤發生時，CI/CD系統也能夠幫我們快速定位問題，並且回滾到之前的版本，減少對使用者的影響。

但其實CICD並不是指某種特定的技術，更多的時候指的是自動化的這個概念，而能夠做到這件事情的工具也非常多，大部分還是看企業內部所使用的部署平台來決定使用哪一種工具，常見的有
像是Jenkins、GitLab CI/CD、GitHub Actions、CircleCI等等。
## GitHub Actions
因為我們公司所使用的平台是github，所以這次也理所當然的使用他所服務的GitHub Actions來做這次的CICD建置，他能夠讓我們在每次push程式碼到遠端倉庫時，自動幫我們執行一系列的工作流程，像是測試、打包、部署等等。

## 流程確定
在實際進行開發前，通堂會跟內部確定一下我們產品在實際部署到用戶端之前 我們應該要做好哪一些的檢查跟部署工作，這當中可以包含測試、程式碼風格檢查、打包、壓縮、部署等等，確定好這些工作後，才能夠開始進行實際的開發工作。

## 簡單說明一下我們這次的CICD流程
1.部署前會先打包成一個容器，並先執行單元測試，確保新程式碼能夠順利運行，沒有因為這次新的功能弄壞舊的功能。
2.進行打包，這邊因為我們是使用aws的ECS服務，所以會把打包好的容器上傳到aws的ECR服務中，方便後續的部署。
3.部署到aws的ECS服務中，這邊會使用aws的CLI工具來進行部署，確保新的容器能夠順利運行在ECS服務中。
4.最後，我們也有撰寫在機器裡面的腳本，會確定機器與容器的port號碼是正確的，並且是回傳200正常回應的。
5.切換nginx讓新的容器能夠對外提供服務。

## 後記
後續轉到後端組之後，也有看過後端組別的CICD，因為服務的特殊性，有一些服務正在運行的排程是不能直接進行中斷的，所以在部署前會先檢查目前是否有正在運行的排程，若有則會等到排程結束後再進行部署，這也是一個很好的做法，能夠確保服務的穩定性。
或者是前端時間也有看到前端在CI流程中加入lighthouse的判斷，用來檢測每次網站部署上去之後，有沒有做了什麼影響SEO效能的操作，這也是一個很好的方式


<h3>閱讀連結</h3>
<p>[IAM 使用者](https://docs.aws.amazon.com/zh_tw/IAM/latest/UserGuide/id_credentials_access-keys.html)</p>
<p>[實作開源小工具，與 Github Actions 的第一次相遇！](https://medium.com/starbugs/%E5%AF%A6%E4%BD%9C%E9%96%8B%E6%BA%90%E5%B0%8F%E5%B7%A5%E5%85%B7-%E8%88%87-github-actions-%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%9B%B8%E9%81%87-3dd2d70eeb)</p>
<p>[深入淺出 OpenID Connect (一)](https://shuninjapan.medium.com/%E6%B7%B1%E5%85%A5%E6%B7%BA%E5%87%BA-openid-connect-%E4%B8%80-8701bbf00958)</p>