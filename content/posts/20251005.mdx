---
title: 內部系統系統重構
description: 樂居後台重構Laravel改成FastApi前後端分席
slug: leju-backend-refactor
date: 2024-10-05
type: Post
---

## 重構

<p>今年部門有一項主要的目標，是要將已經使用了多年已久的後台搬運到新後台的架構上，並嘗試部分以前後端方式去做分離</p>

<p>做系統翻新跟重構這件事情對我來說好像不算很新，之前在104就做過類似的事情，不過那時候的團隊是前端，而這次則是站在全端的視角去進行系統翻新。</p>

<h2>翻新原因</h2>

<p>撇除掉現有後端維護的服務已經超過10個以上的前提下，繼續維持這個沒有必要的額外專案，對團隊內部的人員是額外的學習成本，同時這新後台跟舊後台擁有一樣的權限跟使用者，實在是沒有必要多一個接口，所以在年初的規劃時，就排入今年的TODO List，將舊後台全部搬運到新後台，並將部分功能改用前後分離方式去寫。以達到最小權限跟單一入口的功能(還有就是比較好去追蹤log)</p>

<h2>執行</h2>

<h3>Situation</h3>

<p>後台不像是前端，由外部使用者驗收。後台的使用者是內部人員，以樂居來說 就是資料部，所以跨部門的合作跟確認這件事情是很重要的;而且前後端分離也意味著工程內部需要有對Service、repository值則有明確的規範，誰擁有權限、誰擁有資格。哪個專案負責畫面、哪個專案負責邏輯、哪個專案拿資料</p>

<h3>Task</h3>

<p>
在這項任務中，我只要負責參與專案權責的部分以及開發。在同事盤點完需要執行的頁面時，我就接手了這個project的頁面，並在測試區提供給資料部驗證功能是否符合預期。比較特別的是，因為資料部其實也不是正式的QA人員，很多時候都是happy path，會發生預期以外，或是沒有盤點出來的錯誤。
</p>

<h3>Action</h3>

<p>所以我提出在原有的流程上，在正式環境中先開放兩邊的路口，並約定一個期限把舊入口關閉，雖然這件事情有違上面提到的單一權限這件事情，但在這邊的例子我們卻需要一個資料部能正常運作且逐步推進的灰色階段。後來也確實被採納，避免因為未知錯誤造成的外部影響。</p>

<h3>Result</h3>
<p>整個任務大概維持了一個季度，總共10多個頁面跟邏輯成功抽離，並將許多牽套的組件給拿開，裡面甚至還有超多連CTO也不知道的原因，需要去詢問外部門才知道的邏輯，也在這次重構中解開。我覺得對我來說是一次很新的經驗，畢竟到後端不到半年的時間，有機會參與這種史詩級任務是一個蠻有營養的經驗，也透過重構、以複雜度看問題、外部溝通與協作上，我覺得都有不少的收穫</p>