---
title: 紀錄系統開發紀錄
description: 紀錄系統開發設計反思
slug: leju-coding-design
date: 2025-10-11
type: Post
---

## 背景

<p>今年PM推了一個MVP，是可以在我們新開發的頁面上，顯示每筆房屋資訊的瀏覽、留單、打電話跟連結互動的次數，簡單來說就像是一個我們自架版的GTM，但因為中間有些我們自己希望客製化的邏輯，所以最後不打算透過GTM來達到，打算我們自己做，在聽到這個任務時，自己覺得蠻有趣就把他接了下來，並研究一下以現有的開發時間跟工具下跟怎麼實作</p>

<h2>執行</h2>

<h3>Situation</h3>

<p>在做任務規劃時，我們已有的工具是SQL，而資料筆數大約是600萬筆，我們需要紀錄每筆物件60天內的數據，且這些數據會因為房屋資料不同的操作需要刷新、更新、刪除甚至需要撿回來。所以這是一件非常麻煩的事情，因為資料量最大的量級會是600萬*60=億級資料量。同時，我們也希望房屋資訊的查詢不要過於複雜，希望可以在一張表去解決，因為使用者可能需要同時查詢10筆房屋60天內的資料，而在一個億級資料庫去查找跟計算顯然不是一個好點子</p>

<h3>Task</h3>

<p>
雖然需要對資料庫進行這麼大量的讀和寫操作，我自己覺得超級不適合。這不是SQL所擅長的事情，對Mongo也不適合，而且成本會更高。
考慮這個feature的開發時間只有兩個禮拜，我需要在後端現有的工具中，做出符合需求且對系統負擔最小的選擇。我開始思考有哪些東西是可以捨棄的。在盤點現有的工具過後，我覺得最後的選擇會是透過前端打紀錄api時，我們先紀錄在Redis，這樣先避免高頻率的DB IO操作，而在每天使用者低的時候，在透過我們的排程機器，將紀錄的redis寫回DB。同時用一張中介表去紀錄每天的成效，最後寫回總成效表，而使用者去讀就是讀總成效表。將中間複雜的計算過程放在排程裡，而不是使用者查詢的當下。
</p>

<h3>Action</h3>

<p>在和同事和主管確定這個方案的可行性之後，也跟PM確定一下資料延遲的接受性，就開始實作這件事情。最後在實作過程還需要注意排程失敗的可能，然後也實作了一個小小的sliding window(?來去快速計算加入第一天跟去除第60天的計算，刷題的算法進行這時候有用了xDD。</p>

<h3>Result</h3>
<p>最後把功能完成，並如期能預期工作，且資料庫能正常負荷的了，並如期通過驗收跟測試。這次經驗蠻幫助我拿成本跟需求人員談判，因為這功能雖然很重要，但如果他需要付出的即時成本超過每個月30000塊，那還真的需要嗎？有沒有在需求上能妥協的點。畢竟需求人員每件事情都希望asab(as soon as possible)，所以站好立場，講清楚成本，方案列好，對於雙方的共識跟溝通會有很好的幫助，也不會花了大錢，卻做出不符合商業決策的開發。</p>

[功能設計圖](https://app.diagrams.net/?src=about#G1u_FUJgHL6NDo8PJj8l9Zw4033Ld6o1zf#%7B%22pageId%22%3A%22tild1c0V44OccYTnvrr0%22%7D)
![first normalization photo unload](/images/metric_design.png)